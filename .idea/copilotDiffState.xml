<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/coordinacion/forms.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/coordinacion/forms.py" />
              <option name="originalContent" value="from django import forms&#10;from django.contrib.auth.forms import AuthenticationForm&#10;from .models import Vacante, Empresa, Postulacion, Estudiante, TutorEmpresarial, PracticaEmpresarial, DocenteAsesor&#10;from datetime import date, timedelta&#10;from django.utils import timezone&#10;from django.core.exceptions import ValidationError&#10;from .models import Sustentacion&#10;&#10;&#10;class CoordinadorLoginForm(AuthenticationForm):&#10;    &quot;&quot;&quot;&#10;    Formulario personalizado de login para Coordinador Empresarial&#10;    &quot;&quot;&quot;&#10;    username = forms.CharField(&#10;        label='Usuario',&#10;        max_length=254,&#10;        widget=forms.TextInput(attrs={&#10;            'class': 'form-control',&#10;            'placeholder': 'Ingrese su usuario',&#10;            'autofocus': True&#10;        })&#10;    )&#10;&#10;    password = forms.CharField(&#10;        label='Contraseña',&#10;        widget=forms.PasswordInput(attrs={&#10;            'class': 'form-control',&#10;            'placeholder': 'Ingrese su contraseña'&#10;        })&#10;    )&#10;&#10;&#10;class VacanteForm(forms.ModelForm):&#10;    &quot;&quot;&quot;&#10;    Formulario para crear y editar vacantes de práctica&#10;    &quot;&quot;&quot;&#10;&#10;    class Meta:&#10;        model = Vacante&#10;        fields = [&#10;            'empresa',&#10;            'titulo',&#10;            'area_practica',&#10;            'descripcion',&#10;            'cantidad_cupos',&#10;            'programa_academico',&#10;            'semestre_minimo',&#10;            'habilidades_requeridas',&#10;            'horario',&#10;            'duracion_meses',&#10;            'estado',&#10;        ]&#10;&#10;        widgets = {&#10;            'empresa': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'titulo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Practicante de Desarrollo de Software',&#10;                'required': True&#10;            }),&#10;            'area_practica': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Desarrollo de Software, Marketing Digital, etc.',&#10;                'required': True&#10;            }),&#10;            'descripcion': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 5,&#10;                'placeholder': 'Describe las funciones y responsabilidades del practicante...',&#10;                'required': True&#10;            }),&#10;            'cantidad_cupos': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '1',&#10;                'max': '10',&#10;                'value': '1',&#10;                'required': True&#10;            }),&#10;            'programa_academico': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Ingeniería de Sistemas',&#10;                'required': True&#10;            }),&#10;            'semestre_minimo': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '1',&#10;                'max': '10',&#10;                'value': '6',&#10;                'required': True&#10;            }),&#10;            'habilidades_requeridas': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 3,&#10;                'placeholder': 'Ej: Trabajo en equipo, comunicación efectiva, conocimientos en Python...'&#10;            }),&#10;            'horario': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Lunes a Viernes 8:00am - 5:00pm',&#10;                'required': True&#10;            }),&#10;            'duracion_meses': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '3',&#10;                'max': '12',&#10;                'value': '6',&#10;                'required': True&#10;            }),&#10;            'estado': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'empresa': 'Empresa Formadora',&#10;            'titulo': 'Título de la Vacante',&#10;            'area_practica': 'Área de Práctica',&#10;            'descripcion': 'Descripción Detallada',&#10;            'cantidad_cupos': 'Cantidad de Cupos',&#10;            'programa_academico': 'Programa Académico',&#10;            'semestre_minimo': 'Semestre Mínimo',&#10;            'habilidades_requeridas': 'Habilidades Requeridas',&#10;            'horario': 'Horario',&#10;            'duracion_meses': 'Duración (meses)',&#10;            'estado': 'Estado de la Vacante',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;        # Filtrar solo empresas aprobadas&#10;        self.fields['empresa'].queryset = Empresa.objects.filter(estado='APROBADA')&#10;&#10;        # Si no hay empresas aprobadas, mostrar mensaje&#10;        if not self.fields['empresa'].queryset.exists():&#10;            self.fields['empresa'].empty_label = &quot;No hay empresas aprobadas disponibles&quot;&#10;&#10;    def clean_cantidad_cupos(self):&#10;        cantidad = self.cleaned_data.get('cantidad_cupos')&#10;        if cantidad and cantidad &lt; 1:&#10;            raise forms.ValidationError('Debe haber al menos 1 cupo disponible')&#10;        if cantidad and cantidad &gt; 10:&#10;            raise forms.ValidationError('No se pueden crear más de 10 cupos por vacante')&#10;        return cantidad&#10;&#10;    def clean_semestre_minimo(self):&#10;        semestre = self.cleaned_data.get('semestre_minimo')&#10;        if semestre and semestre &lt; 1:&#10;            raise forms.ValidationError('El semestre mínimo debe ser al menos 1')&#10;        if semestre and semestre &gt; 10:&#10;            raise forms.ValidationError('El semestre mínimo no puede ser mayor a 10')&#10;        return semestre&#10;&#10;    def clean_duracion_meses(self):&#10;        duracion = self.cleaned_data.get('duracion_meses')&#10;        if duracion and duracion &lt; 3:&#10;            raise forms.ValidationError('La duración mínima debe ser 3 meses')&#10;        if duracion and duracion &gt; 12:&#10;            raise forms.ValidationError('La duración máxima debe ser 12 meses')&#10;        return duracion&#10;&#10;&#10;class PostulacionForm(forms.ModelForm):&#10;    &quot;&quot;&quot;&#10;    Formulario para postular estudiantes a vacantes de práctica (RF-03)&#10;    &quot;&quot;&quot;&#10;&#10;    class Meta:&#10;        model = Postulacion&#10;        fields = [&#10;            'vacante',&#10;            'estudiante',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'vacante': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True,&#10;                'id': 'id_vacante'&#10;            }),&#10;            'estudiante': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True,&#10;                'id': 'id_estudiante'&#10;            }),&#10;            'observaciones': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 4,&#10;                'placeholder': 'Observaciones adicionales sobre el estudiante y su idoneidad para esta vacante...',&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'vacante': 'Vacante de Práctica',&#10;            'estudiante': 'Estudiante a Postular',&#10;            'observaciones': 'Observaciones',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;&#10;        # Filtrar solo vacantes disponibles con cupos libres&#10;        self.fields['vacante'].queryset = Vacante.objects.filter(&#10;            estado='DISPONIBLE'&#10;        ).select_related('empresa')&#10;&#10;        # Filtrar solo estudiantes aptos para postular&#10;        self.fields['estudiante'].queryset = Estudiante.objects.filter(&#10;            estado='APTO'&#10;        ).order_by('nombre_completo')&#10;&#10;        # Mensajes si no hay opciones disponibles&#10;        if not self.fields['vacante'].queryset.exists():&#10;            self.fields['vacante'].empty_label = &quot;No hay vacantes disponibles&quot;&#10;&#10;        if not self.fields['estudiante'].queryset.exists():&#10;            self.fields['estudiante'].empty_label = &quot;No hay estudiantes aptos&quot;&#10;&#10;        # Personalizar la visualización de las opciones&#10;        self.fields['vacante'].label_from_instance = self._vacante_label&#10;        self.fields['estudiante'].label_from_instance = self._estudiante_label&#10;&#10;    def _vacante_label(self, obj):&#10;        &quot;&quot;&quot;Personalizar cómo se muestra cada vacante en el select&quot;&quot;&quot;&#10;        cupos_disponibles = obj.cantidad_cupos - obj.cupos_ocupados&#10;        return f&quot;{obj.titulo} - {obj.empresa.razon_social} ({cupos_disponibles} cupos disponibles)&quot;&#10;&#10;    def _estudiante_label(self, obj):&#10;        &quot;&quot;&quot;Personalizar cómo se muestra cada estudiante en el select&quot;&quot;&quot;&#10;        return f&quot;{obj.codigo} - {obj.nombre_completo} ({obj.programa_academico} - {obj.semestre}° sem)&quot;&#10;&#10;    def clean(self):&#10;        cleaned_data = super().clean()&#10;        vacante = cleaned_data.get('vacante')&#10;        estudiante = cleaned_data.get('estudiante')&#10;&#10;        if vacante and estudiante:&#10;            # VALIDACIÓN 1: Verificar que el estudiante no esté ya postulado a esta vacante&#10;            postulacion_existente = Postulacion.objects.filter(&#10;                vacante=vacante,&#10;                estudiante=estudiante&#10;            ).exists()&#10;&#10;            if postulacion_existente:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante {estudiante.nombre_completo} ya está postulado a esta vacante.'&#10;                )&#10;&#10;            # VALIDACIÓN 2: Verificar que la vacante tenga cupos disponibles&#10;            if vacante.cupos_ocupados &gt;= vacante.cantidad_cupos:&#10;                raise forms.ValidationError(&#10;                    f'La vacante &quot;{vacante.titulo}&quot; no tiene cupos disponibles.'&#10;                )&#10;&#10;            # VALIDACIÓN 3: Verificar requisitos académicos del estudiante&#10;            if estudiante.semestre &lt; vacante.semestre_minimo:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante no cumple el requisito de semestre mínimo ({vacante.semestre_minimo}°). '&#10;                    f'El estudiante está en {estudiante.semestre}° semestre.'&#10;                )&#10;&#10;            # VALIDACIÓN 4: Verificar que el estudiante no esté en demasiadas postulaciones activas&#10;            postulaciones_activas = Postulacion.objects.filter(&#10;                estudiante=estudiante,&#10;                estado__in=['POSTULADO', 'SELECCIONADO']&#10;            ).count()&#10;&#10;            if postulaciones_activas &gt;= 3:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante {estudiante.nombre_completo} ya tiene {postulaciones_activas} '&#10;                    f'postulaciones activas. Máximo permitido: 3.'&#10;                )&#10;&#10;        return cleaned_data&#10;&#10;    def save(self, commit=True):&#10;        postulacion = super().save(commit=False)&#10;        postulacion.estado = 'POSTULADO'  # Estado inicial&#10;&#10;        if commit:&#10;            postulacion.save()&#10;&#10;        return postulacion&#10;&#10;&#10;# ==============================&#10;# EmpresaForm (CRUD para Empresa)&#10;# ==============================&#10;class EmpresaForm(forms.ModelForm):&#10;    class Meta:&#10;        model = Empresa&#10;        fields = [&#10;            'razon_social',&#10;            'nit',&#10;            'direccion',&#10;            'telefono',&#10;            'email',&#10;            'ciudad',&#10;            'representante_nombre',&#10;            'representante_cargo',&#10;            'representante_email',&#10;            'representante_telefono',&#10;            'camara_comercio',&#10;            'rut',&#10;            'estado',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'razon_social': forms.TextInput(attrs={'class': 'form-control', 'required': True}),&#10;            'nit': forms.TextInput(attrs={'class': 'form-control', 'required': True}),&#10;            'direccion': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'telefono': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'email': forms.EmailInput(attrs={'class': 'form-control'}),&#10;            'ciudad': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_nombre': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_cargo': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_email': forms.EmailInput(attrs={'class': 'form-control'}),&#10;            'representante_telefono': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'observaciones': forms.Textarea(attrs={'class': 'form-control', 'rows': 3}),&#10;            'estado': forms.Select(attrs={'class': 'form-select'}),&#10;            # ✅ ACTUALIZAR WIDGETS PARA ARCHIVOS&#10;            'camara_comercio': forms.FileInput(attrs={&#10;                'class': 'form-control',&#10;                'accept': '.pdf',&#10;                'onchange': 'validateFile(this, &quot;camara&quot;)'&#10;            }),&#10;            'rut': forms.FileInput(attrs={&#10;                'class': 'form-control',&#10;                'accept': '.pdf',&#10;                'onchange': 'validateFile(this, &quot;rut&quot;)'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'razon_social': 'Razón Social',&#10;            'nit': 'NIT',&#10;            'direccion': 'Dirección',&#10;            'telefono': 'Teléfono',&#10;            'email': 'Email',&#10;            'ciudad': 'Ciudad',&#10;            'representante_nombre': 'Nombre del Representante',&#10;            'representante_cargo': 'Cargo del Representante',&#10;            'representante_email': 'Email del Representante',&#10;            'representante_telefono': 'Teléfono del Representante',&#10;            'camara_comercio': 'Cámara de Comercio (PDF)',&#10;            'rut': 'RUT (PDF)',&#10;            'observaciones': 'Observaciones',&#10;            'estado': 'Estado',&#10;        }&#10;&#10;    # ✅ AÑADIR VALIDACIÓN DE ARCHIVOS PDF&#10;    def clean_camara_comercio(self):&#10;        archivo = self.cleaned_data.get('camara_comercio')&#10;        if archivo:&#10;            # Validar tamaño (máximo 5MB)&#10;            if archivo.size &gt; 5242880:&#10;                raise ValidationError('El archivo no debe superar los 5MB')&#10;            # Validar extensión&#10;            if not archivo.name.endswith('.pdf'):&#10;                raise ValidationError('Solo se permiten archivos PDF')&#10;        return archivo&#10;&#10;    def clean_rut(self):&#10;        archivo = self.cleaned_data.get('rut')&#10;        if archivo:&#10;            # Validar tamaño (máximo 5MB)&#10;            if archivo.size &gt; 5242880:&#10;                raise ValidationError('El archivo no debe superar los 5MB')&#10;            # Validar extensión&#10;            if not archivo.name.endswith('.pdf'):&#10;                raise ValidationError('Solo se permiten archivos PDF')&#10;        return archivo&#10;&#10;    def clean_nit(self):&#10;        nit = self.cleaned_data.get('nit')&#10;        if nit:&#10;            qs = Empresa.objects.filter(nit=nit)&#10;            # En edición, permitimos el mismo registro&#10;            if self.instance and self.instance.pk:&#10;                qs = qs.exclude(pk=self.instance.pk)&#10;            if qs.exists():&#10;                raise ValidationError('Ya existe una empresa con este NIT')&#10;        return nit&#10;&#10;# ==============================&#10;# TutorEmpresarialForm (CRUD para Tutores)&#10;# ==============================&#10;class TutorEmpresarialForm(forms.ModelForm):&#10;    class Meta:&#10;        model = TutorEmpresarial&#10;        fields = [&#10;            'empresa',&#10;            'nombre_completo',&#10;            'cargo',&#10;            'email',&#10;            'telefono',&#10;            'activo',&#10;        ]&#10;&#10;        widgets = {&#10;            'empresa': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'nombre_completo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Jorge Martínez López',&#10;                'required': True&#10;            }),&#10;            'cargo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Líder de Desarrollo',&#10;                'required': True&#10;            }),&#10;            'email': forms.EmailInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'ejemplo@empresa.com',&#10;                'required': True&#10;            }),&#10;            'telefono': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: 3101234567',&#10;                'required': True&#10;            }),&#10;            'activo': forms.CheckboxInput(attrs={&#10;                'class': 'form-check-input'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'empresa': 'Empresa',&#10;            'nombre_completo': 'Nombre Completo',&#10;            'cargo': 'Cargo',&#10;            'email': 'Email',&#10;            'telefono': 'Teléfono',&#10;            'activo': 'Activo',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;        # Filtrar solo empresas aprobadas&#10;        self.fields['empresa'].queryset = Empresa.objects.filter(estado='APROBADA')&#10;&#10;        if not self.fields['empresa'].queryset.exists():&#10;            self.fields['empresa'].empty_label = &quot;No hay empresas aprobadas disponibles&quot;&#10;&#10;    def clean_email(self):&#10;        email = self.cleaned_data.get('email')&#10;        if email:&#10;            # Validar que el email no esté duplicado (excluyendo la instancia actual si es edición)&#10;            qs = TutorEmpresarial.objects.filter(email=email)&#10;            if self.instance and self.instance.pk:&#10;                qs = qs.exclude(pk=self.instance.pk)&#10;            if qs.exists():&#10;                raise ValidationError('Ya existe un tutor con este email')&#10;        return email&#10;&#10;&#10;# ==============================&#10;# SustentacionForm (CRUD para Sustentaciones)&#10;# ==============================&#10;class SustentacionForm(forms.ModelForm):&#10;    class Meta:&#10;        model = Sustentacion&#10;        fields = [&#10;            'practica',&#10;            'fecha_programada',&#10;            'lugar',&#10;            'jurado_1',&#10;            'jurado_2',&#10;            'calificacion',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'practica': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'fecha_programada': forms.DateTimeInput(attrs={&#10;                'class': 'form-control',&#10;                'type': 'datetime-local',&#10;                'required': True&#10;            }),&#10;            'lugar': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Sala de Conferencias A',&#10;                'required': True&#10;            }),&#10;            'jurado_1': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'jurado_2': forms.Select(attrs={&#10;                'class': 'form-select'&#10;            }),&#10;            'calificacion': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '0.0',&#10;                'max': '5.0',&#10;                'step': '0.1',&#10;                'placeholder': 'Ej: 4.5'&#10;            }),&#10;            'observaciones': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 4,&#10;                'placeholder': 'Observaciones adicionales sobre la sustentación...'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'practica': 'Práctica Empresarial',&#10;            'fecha_programada': 'Fecha y Hora Programada',&#10;            'lugar': 'Lugar de Sustentación',&#10;            'jurado_1': 'Jurado Principal',&#10;            'jurado_2': 'Jurado Secundario (Opcional)',&#10;            'calificacion': 'Calificación Final (0.0 - 5.0)',&#10;            'observaciones': 'Observaciones',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;&#10;        # Filtrar solo prácticas finalizadas sin sustentación&#10;        if not self.instance.pk:  # Solo al crear&#10;            self.fields['practica'].queryset = PracticaEmpresarial.objects.filter(&#10;                estado='FINALIZADA',&#10;                sustentacion__isnull=True&#10;            ).select_related('estudiante', 'empresa')&#10;        else:  # Al editar, mostrar la práctica actual&#10;            self.fields['practica'].queryset = PracticaEmpresarial.objects.filter(&#10;                id=self.instance.practica.id&#10;            )&#10;            self.fields['practica'].disabled = True&#10;&#10;        # Filtrar solo docentes activos&#10;        self.fields['jurado_1'].queryset = DocenteAsesor.objects.filter(activo=True)&#10;        self.fields['jurado_2'].queryset = DocenteAsesor.objects.filter(activo=True)&#10;&#10;        # Mensajes si no hay opciones&#10;        if not self.fields['practica'].queryset.exists():&#10;            self.fields['practica'].empty_label = &quot;No hay prácticas finalizadas sin sustentación&quot;&#10;&#10;        if not self.fields['jurado_1'].queryset.exists():&#10;            self.fields['jurado_1'].empty_label = &quot;No hay docentes activos disponibles&quot;&#10;&#10;    def clean(self):&#10;        cleaned_data = super().clean()&#10;        jurado_1 = cleaned_data.get('jurado_1')&#10;        jurado_2 = cleaned_data.get('jurado_2')&#10;        calificacion = cleaned_data.get('calificacion')&#10;        fecha_programada = cleaned_data.get('fecha_programada')&#10;&#10;        # Validar que los jurados sean diferentes&#10;        if jurado_1 and jurado_2 and jurado_1.id == jurado_2.id:&#10;            raise ValidationError('Los jurados deben ser docentes diferentes')&#10;&#10;        # Validar que la fecha sea futura (solo al crear)&#10;        if not self.instance.pk and fecha_programada:&#10;            if fecha_programada &lt; timezone.now():&#10;                raise ValidationError('La fecha de sustentación debe ser futura')&#10;&#10;        # Validar calificación si existe&#10;        if calificacion is not None:&#10;            if calificacion &lt; 0 or calificacion &gt; 5:&#10;                raise ValidationError('La calificación debe estar entre 0.0 y 5.0')&#10;&#10;        return cleaned_data" />
              <option name="updatedContent" value="from django import forms&#10;from django.contrib.auth.forms import AuthenticationForm&#10;from .models import Vacante, Empresa, Postulacion, Estudiante, TutorEmpresarial, PracticaEmpresarial, DocenteAsesor&#10;from datetime import date, timedelta&#10;from django.utils import timezone&#10;from django.core.exceptions import ValidationError&#10;from .models import Sustentacion&#10;&#10;&#10;class CoordinadorLoginForm(AuthenticationForm):&#10;    &quot;&quot;&quot;&#10;    Formulario personalizado de login para Coordinador Empresarial&#10;    &quot;&quot;&quot;&#10;    username = forms.CharField(&#10;        label='Usuario',&#10;        max_length=254,&#10;        widget=forms.TextInput(attrs={&#10;            'class': 'form-control',&#10;            'placeholder': 'Ingrese su usuario',&#10;            'autofocus': True&#10;        })&#10;    )&#10;&#10;    password = forms.CharField(&#10;        label='Contraseña',&#10;        widget=forms.PasswordInput(attrs={&#10;            'class': 'form-control',&#10;            'placeholder': 'Ingrese su contraseña'&#10;        })&#10;    )&#10;&#10;&#10;class VacanteForm(forms.ModelForm):&#10;    &quot;&quot;&quot;&#10;    Formulario para crear y editar vacantes de práctica&#10;    &quot;&quot;&quot;&#10;&#10;    class Meta:&#10;        model = Vacante&#10;        fields = [&#10;            'empresa',&#10;            'titulo',&#10;            'area_practica',&#10;            'descripcion',&#10;            'cantidad_cupos',&#10;            'programa_academico',&#10;            'semestre_minimo',&#10;            'habilidades_requeridas',&#10;            'horario',&#10;            'duracion_meses',&#10;            'estado',&#10;        ]&#10;&#10;        widgets = {&#10;            'empresa': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'titulo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Practicante de Desarrollo de Software',&#10;                'required': True&#10;            }),&#10;            'area_practica': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Desarrollo de Software, Marketing Digital, etc.',&#10;                'required': True&#10;            }),&#10;            'descripcion': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 5,&#10;                'placeholder': 'Describe las funciones y responsabilidades del practicante...',&#10;                'required': True&#10;            }),&#10;            'cantidad_cupos': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '1',&#10;                'max': '10',&#10;                'value': '1',&#10;                'required': True&#10;            }),&#10;            'programa_academico': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Ingeniería de Sistemas',&#10;                'required': True&#10;            }),&#10;            'semestre_minimo': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '1',&#10;                'max': '10',&#10;                'value': '6',&#10;                'required': True&#10;            }),&#10;            'habilidades_requeridas': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 3,&#10;                'placeholder': 'Ej: Trabajo en equipo, comunicación efectiva, conocimientos en Python...'&#10;            }),&#10;            'horario': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Lunes a Viernes 8:00am - 5:00pm',&#10;                'required': True&#10;            }),&#10;            'duracion_meses': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '3',&#10;                'max': '12',&#10;                'value': '6',&#10;                'required': True&#10;            }),&#10;            'estado': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'empresa': 'Empresa Formadora',&#10;            'titulo': 'Título de la Vacante',&#10;            'area_practica': 'Área de Práctica',&#10;            'descripcion': 'Descripción Detallada',&#10;            'cantidad_cupos': 'Cantidad de Cupos',&#10;            'programa_academico': 'Programa Académico',&#10;            'semestre_minimo': 'Semestre Mínimo',&#10;            'habilidades_requeridas': 'Habilidades Requeridas',&#10;            'horario': 'Horario',&#10;            'duracion_meses': 'Duración (meses)',&#10;            'estado': 'Estado de la Vacante',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;        # Filtrar solo empresas aprobadas&#10;        self.fields['empresa'].queryset = Empresa.objects.filter(estado='APROBADA')&#10;&#10;        # Si no hay empresas aprobadas, mostrar mensaje&#10;        if not self.fields['empresa'].queryset.exists():&#10;            self.fields['empresa'].empty_label = &quot;No hay empresas aprobadas disponibles&quot;&#10;&#10;    def clean_cantidad_cupos(self):&#10;        cantidad = self.cleaned_data.get('cantidad_cupos')&#10;        if cantidad and cantidad &lt; 1:&#10;            raise forms.ValidationError('Debe haber al menos 1 cupo disponible')&#10;        if cantidad and cantidad &gt; 10:&#10;            raise forms.ValidationError('No se pueden crear más de 10 cupos por vacante')&#10;        return cantidad&#10;&#10;    def clean_semestre_minimo(self):&#10;        semestre = self.cleaned_data.get('semestre_minimo')&#10;        if semestre and semestre &lt; 1:&#10;            raise forms.ValidationError('El semestre mínimo debe ser al menos 1')&#10;        if semestre and semestre &gt; 10:&#10;            raise forms.ValidationError('El semestre mínimo no puede ser mayor a 10')&#10;        return semestre&#10;&#10;    def clean_duracion_meses(self):&#10;        duracion = self.cleaned_data.get('duracion_meses')&#10;        if duracion and duracion &lt; 3:&#10;            raise forms.ValidationError('La duración mínima debe ser 3 meses')&#10;        if duracion and duracion &gt; 12:&#10;            raise forms.ValidationError('La duración máxima debe ser 12 meses')&#10;        return duracion&#10;&#10;&#10;class PostulacionForm(forms.ModelForm):&#10;    &quot;&quot;&quot;&#10;    Formulario para postular estudiantes a vacantes de práctica (RF-03)&#10;    &quot;&quot;&quot;&#10;&#10;    class Meta:&#10;        model = Postulacion&#10;        fields = [&#10;            'vacante',&#10;            'estudiante',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'vacante': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True,&#10;                'id': 'id_vacante'&#10;            }),&#10;            'estudiante': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True,&#10;                'id': 'id_estudiante'&#10;            }),&#10;            'observaciones': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 4,&#10;                'placeholder': 'Observaciones adicionales sobre el estudiante y su idoneidad para esta vacante...',&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'vacante': 'Vacante de Práctica',&#10;            'estudiante': 'Estudiante a Postular',&#10;            'observaciones': 'Observaciones',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;&#10;        # Filtrar solo vacantes disponibles con cupos libres&#10;        self.fields['vacante'].queryset = Vacante.objects.filter(&#10;            estado='DISPONIBLE'&#10;        ).select_related('empresa')&#10;&#10;        # Filtrar solo estudiantes aptos para postular&#10;        self.fields['estudiante'].queryset = Estudiante.objects.filter(&#10;            estado='APTO'&#10;        ).order_by('nombre_completo')&#10;&#10;        # Mensajes si no hay opciones disponibles&#10;        if not self.fields['vacante'].queryset.exists():&#10;            self.fields['vacante'].empty_label = &quot;No hay vacantes disponibles&quot;&#10;&#10;        if not self.fields['estudiante'].queryset.exists():&#10;            self.fields['estudiante'].empty_label = &quot;No hay estudiantes aptos&quot;&#10;&#10;        # Personalizar la visualización de las opciones&#10;        self.fields['vacante'].label_from_instance = self._vacante_label&#10;        self.fields['estudiante'].label_from_instance = self._estudiante_label&#10;&#10;    def _vacante_label(self, obj):&#10;        &quot;&quot;&quot;Personalizar cómo se muestra cada vacante en el select&quot;&quot;&quot;&#10;        cupos_disponibles = obj.cantidad_cupos - obj.cupos_ocupados&#10;        return f&quot;{obj.titulo} - {obj.empresa.razon_social} ({cupos_disponibles} cupos disponibles)&quot;&#10;&#10;    def _estudiante_label(self, obj):&#10;        &quot;&quot;&quot;Personalizar cómo se muestra cada estudiante en el select&quot;&quot;&quot;&#10;        return f&quot;{obj.codigo} - {obj.nombre_completo} ({obj.programa_academico} - {obj.semestre}° sem)&quot;&#10;&#10;    def clean(self):&#10;        cleaned_data = super().clean()&#10;        vacante = cleaned_data.get('vacante')&#10;        estudiante = cleaned_data.get('estudiante')&#10;&#10;        if vacante and estudiante:&#10;            # VALIDACIÓN 1: Verificar que el estudiante no esté ya postulado a esta vacante&#10;            postulacion_existente = Postulacion.objects.filter(&#10;                vacante=vacante,&#10;                estudiante=estudiante&#10;            ).exists()&#10;&#10;            if postulacion_existente:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante {estudiante.nombre_completo} ya está postulado a esta vacante.'&#10;                )&#10;&#10;            # VALIDACIÓN 2: Verificar que la vacante tenga cupos disponibles&#10;            if vacante.cupos_ocupados &gt;= vacante.cantidad_cupos:&#10;                raise forms.ValidationError(&#10;                    f'La vacante &quot;{vacante.titulo}&quot; no tiene cupos disponibles.'&#10;                )&#10;&#10;            # VALIDACIÓN 3: Verificar requisitos académicos del estudiante&#10;            if estudiante.semestre &lt; vacante.semestre_minimo:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante no cumple el requisito de semestre mínimo ({vacante.semestre_minimo}°). '&#10;                    f'El estudiante está en {estudiante.semestre}° semestre.'&#10;                )&#10;&#10;            # VALIDACIÓN 4: Verificar que el estudiante no esté en demasiadas postulaciones activas&#10;            postulaciones_activas = Postulacion.objects.filter(&#10;                estudiante=estudiante,&#10;                estado__in=['POSTULADO', 'SELECCIONADO']&#10;            ).count()&#10;&#10;            if postulaciones_activas &gt;= 3:&#10;                raise forms.ValidationError(&#10;                    f'El estudiante {estudiante.nombre_completo} ya tiene {postulaciones_activas} '&#10;                    f'postulaciones activas. Máximo permitido: 3.'&#10;                )&#10;&#10;        return cleaned_data&#10;&#10;    def save(self, commit=True):&#10;        postulacion = super().save(commit=False)&#10;        postulacion.estado = 'POSTULADO'  # Estado inicial&#10;&#10;        if commit:&#10;            postulacion.save()&#10;&#10;        return postulacion&#10;&#10;&#10;# ==============================&#10;# EmpresaForm (CRUD para Empresa)&#10;# ==============================&#10;class EmpresaForm(forms.ModelForm):&#10;    class Meta:&#10;        model = Empresa&#10;        fields = [&#10;            'razon_social',&#10;            'nit',&#10;            'direccion',&#10;            'telefono',&#10;            'email',&#10;            'ciudad',&#10;            'representante_nombre',&#10;            'representante_cargo',&#10;            'representante_email',&#10;            'representante_telefono',&#10;            'camara_comercio',&#10;            'rut',&#10;            'estado',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'razon_social': forms.TextInput(attrs={'class': 'form-control', 'required': True}),&#10;            'nit': forms.TextInput(attrs={'class': 'form-control', 'required': True}),&#10;            'direccion': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'telefono': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'email': forms.EmailInput(attrs={'class': 'form-control'}),&#10;            'ciudad': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_nombre': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_cargo': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'representante_email': forms.EmailInput(attrs={'class': 'form-control'}),&#10;            'representante_telefono': forms.TextInput(attrs={'class': 'form-control'}),&#10;            'observaciones': forms.Textarea(attrs={'class': 'form-control', 'rows': 3}),&#10;            'estado': forms.Select(attrs={'class': 'form-select'}),&#10;            # ✅ ACTUALIZAR WIDGETS PARA ARCHIVOS&#10;            'camara_comercio': forms.FileInput(attrs={&#10;                'class': 'form-control',&#10;                'accept': '.pdf',&#10;                'onchange': 'validateFile(this, &quot;camara&quot;)'&#10;            }),&#10;            'rut': forms.FileInput(attrs={&#10;                'class': 'form-control',&#10;                'accept': '.pdf',&#10;                'onchange': 'validateFile(this, &quot;rut&quot;)'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'razon_social': 'Razón Social',&#10;            'nit': 'NIT',&#10;            'direccion': 'Dirección',&#10;            'telefono': 'Teléfono',&#10;            'email': 'Email',&#10;            'ciudad': 'Ciudad',&#10;            'representante_nombre': 'Nombre del Representante',&#10;            'representante_cargo': 'Cargo del Representante',&#10;            'representante_email': 'Email del Representante',&#10;            'representante_telefono': 'Teléfono del Representante',&#10;            'camara_comercio': 'Cámara de Comercio (PDF)',&#10;            'rut': 'RUT (PDF)',&#10;            'observaciones': 'Observaciones',&#10;            'estado': 'Estado',&#10;        }&#10;&#10;    # ✅ AÑADIR VALIDACIÓN DE ARCHIVOS PDF&#10;    def clean_camara_comercio(self):&#10;        archivo = self.cleaned_data.get('camara_comercio')&#10;        if archivo:&#10;            # Validar tamaño (máximo 5MB)&#10;            if archivo.size &gt; 5242880:&#10;                raise ValidationError('El archivo no debe superar los 5MB')&#10;            # Validar extensión&#10;            if not archivo.name.endswith('.pdf'):&#10;                raise ValidationError('Solo se permiten archivos PDF')&#10;        return archivo&#10;&#10;    def clean_rut(self):&#10;        archivo = self.cleaned_data.get('rut')&#10;        if archivo:&#10;            # Validar tamaño (máximo 5MB)&#10;            if archivo.size &gt; 5242880:&#10;                raise ValidationError('El archivo no debe superar los 5MB')&#10;            # Validar extensión&#10;            if not archivo.name.endswith('.pdf'):&#10;                raise ValidationError('Solo se permiten archivos PDF')&#10;        return archivo&#10;&#10;    def clean_nit(self):&#10;        nit = self.cleaned_data.get('nit')&#10;        if nit:&#10;            qs = Empresa.objects.filter(nit=nit)&#10;            # En edición, permitimos el mismo registro&#10;            if self.instance and self.instance.pk:&#10;                qs = qs.exclude(pk=self.instance.pk)&#10;            if qs.exists():&#10;                raise ValidationError('Ya existe una empresa con este NIT')&#10;        return nit&#10;&#10;# ==============================&#10;# TutorEmpresarialForm (CRUD para Tutores)&#10;# ==============================&#10;class TutorEmpresarialForm(forms.ModelForm):&#10;    class Meta:&#10;        model = TutorEmpresarial&#10;        fields = [&#10;            'empresa',&#10;            'nombre_completo',&#10;            'cargo',&#10;            'email',&#10;            'telefono',&#10;            'activo',&#10;        ]&#10;&#10;        widgets = {&#10;            'empresa': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'nombre_completo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Jorge Martínez López',&#10;                'required': True&#10;            }),&#10;            'cargo': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Líder de Desarrollo',&#10;                'required': True&#10;            }),&#10;            'email': forms.EmailInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'ejemplo@empresa.com',&#10;                'required': True&#10;            }),&#10;            'telefono': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: 3101234567',&#10;                'required': True&#10;            }),&#10;            'activo': forms.CheckboxInput(attrs={&#10;                'class': 'form-check-input'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'empresa': 'Empresa',&#10;            'nombre_completo': 'Nombre Completo',&#10;            'cargo': 'Cargo',&#10;            'email': 'Email',&#10;            'telefono': 'Teléfono',&#10;            'activo': 'Activo',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;        # Filtrar solo empresas aprobadas&#10;        self.fields['empresa'].queryset = Empresa.objects.filter(estado='APROBADA')&#10;&#10;        if not self.fields['empresa'].queryset.exists():&#10;            self.fields['empresa'].empty_label = &quot;No hay empresas aprobadas disponibles&quot;&#10;&#10;    def clean_email(self):&#10;        email = self.cleaned_data.get('email')&#10;        if email:&#10;            # Validar que el email no esté duplicado (excluyendo la instancia actual si es edición)&#10;            qs = TutorEmpresarial.objects.filter(email=email)&#10;            if self.instance and self.instance.pk:&#10;                qs = qs.exclude(pk=self.instance.pk)&#10;            if qs.exists():&#10;                raise ValidationError('Ya existe un tutor con este email')&#10;        return email&#10;&#10;&#10;# ==============================&#10;# SustentacionForm (CRUD para Sustentaciones)&#10;# ==============================&#10;class SustentacionForm(forms.ModelForm):&#10;    class Meta:&#10;        model = Sustentacion&#10;        fields = [&#10;            'practica',&#10;            'fecha_programada',&#10;            'lugar',&#10;            'jurado_1',&#10;            'jurado_2',&#10;            'calificacion',&#10;            'observaciones',&#10;        ]&#10;&#10;        widgets = {&#10;            'practica': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'fecha_programada': forms.DateTimeInput(attrs={&#10;                'class': 'form-control',&#10;                'type': 'datetime-local',&#10;                'required': True&#10;            }),&#10;            'lugar': forms.TextInput(attrs={&#10;                'class': 'form-control',&#10;                'placeholder': 'Ej: Sala de Conferencias A',&#10;                'required': True&#10;            }),&#10;            'jurado_1': forms.Select(attrs={&#10;                'class': 'form-select',&#10;                'required': True&#10;            }),&#10;            'jurado_2': forms.Select(attrs={&#10;                'class': 'form-select'&#10;            }),&#10;            'calificacion': forms.NumberInput(attrs={&#10;                'class': 'form-control',&#10;                'min': '0.0',&#10;                'max': '5.0',&#10;                'step': '0.1',&#10;                'placeholder': 'Ej: 4.5'&#10;            }),&#10;            'observaciones': forms.Textarea(attrs={&#10;                'class': 'form-control',&#10;                'rows': 4,&#10;                'placeholder': 'Observaciones adicionales sobre la sustentación...'&#10;            }),&#10;        }&#10;&#10;        labels = {&#10;            'practica': 'Práctica Empresarial',&#10;            'fecha_programada': 'Fecha y Hora Programada',&#10;            'lugar': 'Lugar de Sustentación',&#10;            'jurado_1': 'Jurado Principal',&#10;            'jurado_2': 'Jurado Secundario (Opcional)',&#10;            'calificacion': 'Calificación Final (0.0 - 5.0)',&#10;            'observaciones': 'Observaciones',&#10;        }&#10;&#10;    def __init__(self, *args, **kwargs):&#10;        super().__init__(*args, **kwargs)&#10;&#10;        # Filtrar solo prácticas finalizadas sin sustentación&#10;        if not self.instance.pk:  # Solo al crear&#10;            self.fields['practica'].queryset = PracticaEmpresarial.objects.filter(&#10;                estado='FINALIZADA',&#10;                sustentacion__isnull=True&#10;            ).select_related('estudiante', 'empresa')&#10;        else:  # Al editar, mostrar la práctica actual&#10;            self.fields['practica'].queryset = PracticaEmpresarial.objects.filter(&#10;                id=self.instance.practica.id&#10;            )&#10;            self.fields['practica'].disabled = True&#10;&#10;        # Filtrar solo docentes activos&#10;        self.fields['jurado_1'].queryset = DocenteAsesor.objects.filter(activo=True)&#10;        self.fields['jurado_2'].queryset = DocenteAsesor.objects.filter(activo=True)&#10;&#10;        # Mensajes si no hay opciones&#10;        if not self.fields['practica'].queryset.exists():&#10;            self.fields['practica'].empty_label = &quot;No hay prácticas finalizadas sin sustentación&quot;&#10;&#10;        if not self.fields['jurado_1'].queryset.exists():&#10;            self.fields['jurado_1'].empty_label = &quot;No hay docentes activos disponibles&quot;&#10;&#10;    def clean(self):&#10;        cleaned_data = super().clean()&#10;        jurado_1 = cleaned_data.get('jurado_1')&#10;        jurado_2 = cleaned_data.get('jurado_2')&#10;        calificacion = cleaned_data.get('calificacion')&#10;        fecha_programada = cleaned_data.get('fecha_programada')&#10;&#10;        # Validar que los jurados sean diferentes&#10;        if jurado_1 and jurado_2 and jurado_1.id == jurado_2.id:&#10;            raise ValidationError('Los jurados deben ser docentes diferentes')&#10;&#10;        # Validar que la fecha sea futura (solo al crear)&#10;        if not self.instance.pk and fecha_programada:&#10;            if fecha_programada &lt; timezone.now():&#10;                raise ValidationError('La fecha de sustentación debe ser futura')&#10;&#10;        # Validar calificación si existe&#10;        if calificacion is not None:&#10;            if calificacion &lt; 0 or calificacion &gt; 5:&#10;                raise ValidationError('La calificación debe estar entre 0.0 y 5.0')&#10;&#10;        # Validación defensiva: verificar que la práctica aún no tenga sustentación&#10;        practica = cleaned_data.get('practica')&#10;        if not self.instance.pk and practica:&#10;            # Si la práctica ya tiene una sustentación registrada, rechazar&#10;            if PracticaEmpresarial.objects.filter(id=practica.id, sustentacion__isnull=False).exists():&#10;                raise ValidationError('La práctica seleccionada ya tiene una sustentación registrada')&#10;&#10;        return cleaned_data" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>