{% extends 'docente/base.html' %}

{% block title %}Revisar Seguimiento - Docente Asesor{% endblock %}

{% block content %}
<!-- Top Bar -->
<div class="top-bar">
    <h2><i class="fas fa-clipboard-check"></i> Revisar Seguimiento Semanal</h2>
    {% include 'docente/_topbar_user_dropdown.html' %}
</div>

<!-- Información del Seguimiento -->
<div class="row mb-4">
    <div class="col-12">
        {% if not puede_editar %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Seguimiento No Editable:</strong> Solo puedes editar el seguimiento más reciente. Este seguimiento ya ha sido evaluado y hay seguimientos más nuevos.
        </div>
        {% elif es_seguimiento_mas_reciente and seguimiento.calificacion %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Modo Edición:</strong> Este es el seguimiento más reciente. Puedes modificar la calificación y retroalimentación hasta que se envíe un nuevo seguimiento.
        </div>
        {% endif %}

        <div class="card">
            <div class="card-header">
                <i class="fas fa-info-circle"></i> Información del Seguimiento - Semana {{ seguimiento.semana_numero }}
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="fas fa-user"></i> Estudiante</h5>
                        <p><strong>{{ seguimiento.practica.estudiante.nombre_completo }}</strong></p>
                        <p class="text-muted">Código: {{ seguimiento.practica.estudiante.codigo }}</p>
                        <p class="text-muted">Programa: {{ seguimiento.practica.estudiante.programa_academico }}</p>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-building"></i> Empresa</h5>
                        <p><strong>{{ seguimiento.practica.empresa.razon_social }}</strong></p>
                        <p class="text-muted">Periodo: {{ seguimiento.fecha_inicio|date:"d/m/Y" }} - {{ seguimiento.fecha_fin|date:"d/m/Y" }}</p>
                        <p class="text-muted">Fecha Registro: {{ seguimiento.fecha_registro|date:"d/m/Y H:i" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contenido del Seguimiento -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-tasks"></i> Actividades y Logros
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <h5><i class="fas fa-list"></i> Actividades Realizadas</h5>
                    <div class="p-3" style="background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--primary-blue);">
                        {{ seguimiento.actividades_realizadas|linebreaks }}
                    </div>
                </div>

                {% if seguimiento.logros %}
                <div class="mb-4">
                    <h5><i class="fas fa-trophy"></i> Logros</h5>
                    <div class="p-3" style="background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                        {{ seguimiento.logros|linebreaks }}
                    </div>
                </div>
                {% endif %}

                {% if seguimiento.dificultades %}
                <div class="mb-4">
                    <h5><i class="fas fa-exclamation-triangle"></i> Dificultades</h5>
                    <div class="p-3" style="background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                        {{ seguimiento.dificultades|linebreaks }}
                    </div>
                </div>
                {% endif %}

                {% if seguimiento.evidencia %}
                <div class="mb-4">
                    <h5><i class="fas fa-paperclip"></i> Evidencia Adjunta</h5>
                    <a href="{{ seguimiento.evidencia.url }}" target="_blank" class="btn btn-primary">
                        <i class="fas fa-download"></i> Descargar Evidencia
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Formulario de Revisión -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-edit"></i> Evaluación del Docente
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    {% if puede_editar %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Sistema de Evaluación Automática:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Nota <strong>≥ 3.0</strong> → Seguimiento <span class="badge bg-success">Aprobado</span></li>
                            <li>Nota <strong>< 3.0</strong> → Seguimiento <span class="badge bg-danger">Requiere Correcciones</span></li>
                        </ul>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <label for="calificacion" class="form-label">
                            <i class="fas fa-star"></i> Calificación (0.0 - 5.0)
                            {% if puede_editar %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <input
                            type="number"
                            class="form-control"
                            id="calificacion"
                            name="calificacion"
                            step="0.1"
                            min="0"
                            max="5"
                            value="{{ seguimiento.calificacion|default:'' }}"
                            placeholder="Ej: 4.5"
                            {% if puede_editar %}required{% else %}readonly disabled{% endif %}>
                        <small class="text-muted">
                            {% if puede_editar %}
                                Calificación numérica del seguimiento semanal (obligatorio).
                                El estado se asignará automáticamente según la nota.
                            {% else %}
                                Este seguimiento ya no puede ser editado. Solo el seguimiento más reciente es editable.
                            {% endif %}
                        </small>
                    </div>

                    <div class="mb-3">
                        <label for="observaciones_docente" class="form-label">
                            <i class="fas fa-comment"></i> Observaciones y Retroalimentación
                        </label>
                        <textarea
                            class="form-control"
                            id="observaciones_docente"
                            name="observaciones_docente"
                            rows="5"
                            placeholder="Escribe tus observaciones, sugerencias o retroalimentación para el estudiante..."
                            {% if not puede_editar %}readonly disabled{% endif %}>{{ seguimiento.observaciones_docente }}</textarea>
                        <small class="text-muted">
                            {% if puede_editar %}
                                Retroalimentación para ayudar al estudiante a mejorar (opcional pero recomendado).
                            {% else %}
                                Retroalimentación registrada previamente.
                            {% endif %}
                        </small>
                    </div>

                    <div class="d-flex gap-2">
                        {% if puede_editar %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>{% if seguimiento.calificacion %}Actualizar{% else %}Evaluar{% endif %} Seguimiento
                        </button>
                        {% endif %}
                        <a href="{% url 'docente:seguimientos_pendientes' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Volver
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

